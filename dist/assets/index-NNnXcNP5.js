import{q as ye,r as n,j as i,B as G,T as d,S as w,n as S}from"./index-BvHICZLu.js";import{U as y}from"./select-BdR5dIob.js";import{U as a}from"./input-0CiLpJeF.js";import{U as O,g as be}from"./getImage-CU6HJwcy.js";import{U as Fe}from"./switch-CPhNpkUH.js";import{u as N}from"./useFetchGetAllDatas-D9BijkDb.js";import{g as k}from"./getFilteredList-B2eBHppK.js";import{u as we,c as ke}from"./apiUpdateCalls-DnLJHN2L.js";const x=({data:h,key:t})=>{console.log(h,t);const f=[];return h.map(o=>{if(t==="file"&&!o[t])return f;o[t]!==""&&o[t]!==null&&o[t]!==void 0&&(f.push(o[t]),console.log(o[t],h,t))}),f},Q=h=>new Promise((t,f)=>{const o=new FileReader;o.onloadend=()=>{const p=o.result;p&&typeof p=="string"?t(p.split(",")[1]):f(new Error("Failed to convert file to Base64."))},o.onerror=p=>{f(p)},o.readAsDataURL(h)}),Pe=({isEdit:h,data:t})=>{console.log(t);const f=ye(),o=[{id:"0",value:"Gallery"},{id:"1",value:"Audio"},{id:"2",value:"File"},{id:"3",value:"Virtual_reality"},{id:"4",value:"Video"},{id:"5",value:"Location"}],p={Gallery:"file",Audio:"file",File:"file",Virtual_reality:"file",Video:"link",Location:"location"},[c,X]=n.useState({id:t==null?void 0:t.category,value:t==null?void 0:t.cat_name}),[_,z]=n.useState({id:t==null?void 0:t.filter_category,value:t==null?void 0:t.filter_category_name}),[b,q]=n.useState({id:t==null?void 0:t.filters,value:t==null?void 0:t.filters_name}),[F,Y]=n.useState({id:t==null?void 0:t.period_filter,value:t==null?void 0:t.period_filter_name}),[I,Z]=n.useState((t==null?void 0:t.title)||""),[L,H]=n.useState(null),[J,$]=n.useState((t==null?void 0:t.content)||""),[K,ee]=n.useState((t==null?void 0:t.statehood)||!1),[T,te]=n.useState({id:t==null?void 0:t.province,value:t==null?void 0:t.province_name}),[m,B]=n.useState((t==null?void 0:t.attributes_list)||[{id:Date.now(),attributes_title:"",attributes_description:"",sequence:1}]),[v,U]=n.useState((t==null?void 0:t.contents_list)||[{id:Date.now(),contents_title:"",sequence:1,contents_description:""}]),[r,P]=n.useState((t==null?void 0:t.interive_list)||[{id:Date.now(),interive_item:"file",interive_title:"",interive_sequence:1,interive_file:null,interive_link:"",interive_latitude:"",interive_longitude:""}]);n.useEffect(()=>{async function e(){const l=await be(t==null?void 0:t.image,t==null?void 0:t.image);H(l)}e()},[t]);const[ie,E]=n.useState(!1),le=()=>{let e=[...m,{id:Date.now(),attributes_title:"",attributes_description:"",sequence:1}];B(e)},W=(e,l,s)=>{const u=[...m];u[e]={...m[e],[l]:s},B(u)},se=e=>{const l=[...m];l.splice(e,1),B(l)},ne=()=>{let e=[...v,{id:Date.now(),contents_title:"",sequence:1,contents_description:""}];U(e)},R=(e,l,s)=>{const u=[...v];u[e]={...v[e],[l]:s},U(u)},oe=e=>{const l=[...v];l.splice(e,1),U(l)},re=()=>{let e=[...r,{id:Date.now(),interive_item:"file",interive_title:"",interive_sequence:1,interive_file:null,interive_link:"",interive_latitude:"",interive_longitude:""}];P(e)},j=(e,l,s)=>{const u=[...r];if(l==="interive_file"&&s instanceof FileList){const C=new FileReader;C.onloadend=()=>{u[e]={...r[e],[l]:C.result}},console.log(s),C.readAsDataURL(s[0]),console.log("go",C.result)}l==="interive_item"&&typeof s=="string"?u[e]={...r[e],[l]:p[s],interive_status:s}:u[e]={...r[e],[l]:s},console.log(l,s,u),P(u)},ce=e=>{const l=[...r];l.splice(e,1),P(l)},[A,ue]=n.useState([]),[ae,pe]=n.useState([]),{data:D}=N("category"),{data:de}=N("period_filter"),{data:xe}=N("province");n.useEffect(()=>{D==null||D.map(e=>{e.id===(c==null?void 0:c.id)&&ue(e.categories)})},[c]),n.useEffect(()=>{A==null||A.map(e=>{_&&e.id===_.id&&pe(e.filters_category)})},[_]);const fe=k({data:D}),_e=k({data:A}),ge=k({data:ae}),he=k({data:de}),me=k({data:xe}),ve=async()=>{if(!c||!_||!b||!F||!I)return;E(!0);const e=x({data:m,key:"attributes_title"}),l=x({data:m,key:"attributes_description"}),s=x({data:v,key:"contents_title"}),u=x({data:v,key:"contents_description"}),C=x({data:r,key:"interive_title"}),je=x({data:r,key:"interive_status"}),M=x({data:r,key:"interive_file"}),Ve=x({data:r,key:"interive_link"}),Se=x({data:r,key:"interive_latitude"}),Ce=x({data:r,key:"interive_longitude"}),g={category:(c==null?void 0:c.id)+"",filter_category:(_==null?void 0:_.id)+"",filters:(b==null?void 0:b.id)+"",period_filter:(F==null?void 0:F.id)+"",title:I,image:null,content:J,statehood:K,province:(T==null?void 0:T.id)+"",attributes_title_list:e,attributes_description_list:l,contents_title_list:s,contents_description_list:u,interive_title_list:C,status_list:je,interive_file_list:[],link_list:Ve,latitude_list:Se,longitude_list:Ce};M.length>0&&(g.interive_file_list=M),h?(g.image=L&&await Q(L),we("resource",t==null?void 0:t.id,g).then(V=>(f("/sources",{replace:!0}),V)).catch(V=>console.log(V,g)).finally(()=>{E(!1)})):(g.image=L&&await Q(L),ke("resource",g).then(V=>{f("/sources",{replace:!0}),console.log(V,g)}).catch(V=>console.log(V,g)).finally(()=>{console.log("it should be working",g),E(!1)}))};return i.jsxs(G,{children:[i.jsxs(d,{sx:{marginBottom:"10px"},children:["Filter ",c&&c.value]}),i.jsx(y,{options:fe,placeholder:"Select a category",defaultValue:c,updateValue:e=>{X(e),z({id:"",value:""}),q({id:"",value:""})}}),i.jsxs(w,{direction:"row",gap:5,sx:{margin:"20px 0"},children:[i.jsx(y,{disabled:!!c,options:_e,defaultValue:_,placeholder:"Select a filter category",updateValue:e=>{z(e),q({id:"",value:""})}}),i.jsx(y,{disabled:!!c&&!!_,options:ge,defaultValue:b,placeholder:"Select a filter",updateValue:e=>q(e)})]}),i.jsxs(d,{sx:{margin:"15px 0 5px"},children:[i.jsx("span",{style:{color:"red"},children:"*"})," Select period filter"]}),i.jsx(y,{options:he,defaultValue:F,placeholder:"",updateValue:e=>Y(e)}),i.jsxs(d,{sx:{margin:"15px 0 5px"},children:[i.jsx("span",{style:{color:"red"},children:"*"})," Title"]}),i.jsx(a,{updateValue:e=>Z(e),defaultValue:I}),i.jsx(d,{sx:{margin:"20px 0 10px"},children:"Click to upload an image"}),i.jsx(O,{fileChange:e=>e&&H(e[0]),defaultFile:t==null?void 0:t.image,id:"one"}),i.jsx(d,{sx:{margin:"20px 0 10px"},children:"Content"}),i.jsx(a,{updateValue:e=>$(e),defaultValue:J}),i.jsx(d,{sx:{margin:"20px 0 10px"},children:"Statehood"}),i.jsx(Fe,{value:K,changeValue:e=>ee(e)}),i.jsxs(d,{sx:{margin:"15px 0 5px"},children:[i.jsx("span",{style:{color:"red"},children:"*"})," Select Province"]}),i.jsx(y,{options:me,defaultValue:T,placeholder:"",updateValue:e=>te(e)}),i.jsxs(d,{sx:{margin:"15px 0 5px"},children:[i.jsx("span",{style:{color:"red"},children:"*"})," Attributes"]}),m.map((e,l)=>i.jsxs(w,{direction:"row",gap:2,sx:{marginBottom:"10px"},children:[i.jsx(a,{updateValue:s=>W(l,"attributes_title",s),defaultValue:e.attributes_title,placeholder:"Title"}),i.jsx(a,{updateValue:s=>W(l,"attributes_description",s),defaultValue:e.attributes_description,placeholder:"Description"}),i.jsx(a,{type:"number",fullWidth:!1,updateValue:s=>W(l,"sequence",s),placeholder:"Sequence",defaultValue:e.sequence}),m.length>1&&i.jsx(S,{variant:"contained",onClick:()=>se(l),children:"Delete"})]},e.id)),i.jsx(S,{variant:"outlined",fullWidth:!0,sx:{marginTop:"10px"},onClick:le,children:"Add Attribute"}),i.jsxs(d,{sx:{margin:"15px 0 5px"},children:[i.jsx("span",{style:{color:"red"},children:"*"})," Contents"]}),v.map((e,l)=>i.jsxs(G,{children:[i.jsxs(w,{direction:"row",gap:2,sx:{marginBottom:"10px"},children:[i.jsx(a,{updateValue:s=>R(l,"contents_title",s),defaultValue:e.contents_title,placeholder:"Title"}),i.jsx(a,{type:"number",fullWidth:!1,updateValue:s=>R(l,"sequence",s),placeholder:"Sequence",defaultValue:e.sequence})]}),i.jsx(a,{updateValue:s=>R(l,"contents_description",s),defaultValue:e.contents_description,placeholder:""}),v.length>1&&i.jsx(S,{variant:"contained",onClick:()=>oe(l),children:"Delete"})]},e.id)),i.jsx(S,{variant:"outlined",fullWidth:!0,sx:{marginTop:"10px"},onClick:ne,children:"Add Content"}),i.jsxs(d,{sx:{margin:"15px 0 5px"},children:[i.jsx("span",{style:{color:"red"},children:"*"})," Interactive Content"]}),r.map((e,l)=>(console.log(e),i.jsxs(G,{children:[i.jsxs(w,{direction:"row",gap:2,sx:{margin:"10px 0"},children:[i.jsx(y,{options:o,defaultValue:{id:o[0].id||"0",value:e.status||o[0].value},placeholder:"Select type",updateValue:s=>j(l,"interive_item",s.value)}),i.jsx(a,{updateValue:s=>j(l,"interive_title",s),defaultValue:e.title,placeholder:"Title"}),i.jsx(a,{type:"number",fullWidth:!1,updateValue:s=>j(l,"interive_sequence",s),placeholder:"Sequence",defaultValue:e.sequence})]}),(p[e.status]==="file"||e.interive_item==="file")&&i.jsx(O,{id:l+"",defaultFile:e.file,fileChange:s=>j(l,"interive_file",s)}),(p[e.status]==="link"||e.interive_item==="link")&&i.jsx(a,{updateValue:s=>j(l,"interive_link",s),defaultValue:e.link,placeholder:"Link"}),(p[e.status]==="location"||e.interive_item==="location")&&i.jsxs(w,{direction:"row",gap:2,children:[i.jsx(a,{updateValue:s=>j(l,"interive_latitude",s),defaultValue:e.latitude,placeholder:"Latitude"}),i.jsx(a,{updateValue:s=>j(l,"interive_longitude",s),defaultValue:e.longitude,placeholder:"Longitude"})]}),r.length>1&&i.jsx(S,{variant:"contained",sx:{margin:"10px 0"},onClick:()=>ce(l),children:"Delete"})]},e.id))),i.jsx(S,{variant:"outlined",fullWidth:!0,sx:{marginTop:"10px"},onClick:re,children:"Add Interactive Content"}),i.jsx(S,{variant:"contained",disabled:ie,onClick:ve,sx:{marginTop:"20px"},children:h?"Edit":"Create"})]})};export{Pe as C};
